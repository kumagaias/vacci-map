<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VacciMap â€” æ„ŸæŸ“ç—‡ãƒã‚¶ãƒ¼ãƒ‰ãƒãƒƒãƒ—</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"/>
<style>
  :root {
    --bg: #0a0e1a;
    --surface: #111827;
    --surface2: #1a2235;
    --border: rgba(255,255,255,0.07);
    --text: #e8edf5;
    --text-dim: #6b7fa3;
    --accent: #38bdf8;
    --risk-low: #22c55e;
    --risk-moderate: #f59e0b;
    --risk-high: #ef4444;
    --risk-critical: #dc2626;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Noto Sans JP', sans-serif;
    background: var(--bg);
    color: var(--text);
    height: 100vh;
    display: grid;
    grid-template-rows: 56px 1fr;
    grid-template-columns: 1fr 340px;
    overflow: hidden;
  }

  /* â”€â”€ ãƒ˜ãƒƒãƒ€ãƒ¼ â”€â”€ */
  header {
    grid-column: 1 / -1;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 0 20px;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    z-index: 1000;
  }

  .logo {
    font-family: 'DM Mono', monospace;
    font-size: 18px;
    font-weight: 500;
    color: var(--accent);
    letter-spacing: -0.5px;
  }
  .logo span { color: var(--text-dim); font-weight: 400; }

  .header-badge {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    padding: 2px 8px;
    border-radius: 99px;
    background: rgba(239,68,68,0.15);
    color: #ef4444;
    border: 1px solid rgba(239,68,68,0.3);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .search-bar {
    margin-left: auto;
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .search-bar input {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 6px 14px;
    color: var(--text);
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 13px;
    width: 220px;
    outline: none;
    transition: border-color 0.2s;
  }
  .search-bar input:focus { border-color: var(--accent); }
  .search-bar input::placeholder { color: var(--text-dim); }

  .search-btn {
    background: var(--accent);
    color: #0a0e1a;
    border: none;
    border-radius: 8px;
    padding: 6px 14px;
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: opacity 0.2s;
  }
  .search-btn:hover { opacity: 0.85; }

  /* â”€â”€ åœ°å›³ â”€â”€ */
  #map {
    grid-row: 2;
    grid-column: 1;
    background: #0d1220;
  }

  /* â”€â”€ ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ« â”€â”€ */
  .panel {
    grid-row: 2;
    grid-column: 2;
    background: var(--surface);
    border-left: 1px solid var(--border);
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .panel-section {
    padding: 16px;
    border-bottom: 1px solid var(--border);
  }

  .panel-label {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 10px;
  }

  /* ã‚¨ãƒªã‚¢æƒ…å ± */
  .area-name {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 4px;
  }

  .risk-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    font-weight: 500;
    padding: 3px 10px;
    border-radius: 99px;
  }
  .risk-pill.high {
    background: rgba(239,68,68,0.15);
    color: #ef4444;
    border: 1px solid rgba(239,68,68,0.3);
  }
  .risk-pill.moderate {
    background: rgba(245,158,11,0.15);
    color: #f59e0b;
    border: 1px solid rgba(245,158,11,0.3);
  }
  .risk-pill.low {
    background: rgba(34,197,94,0.15);
    color: #22c55e;
    border: 1px solid rgba(34,197,94,0.3);
  }
  .risk-pill.critical {
    background: rgba(220,38,38,0.2);
    color: #dc2626;
    border: 1px solid rgba(220,38,38,0.4);
  }

  /* ç–¾æ‚£ã‚«ãƒ¼ãƒ‰ */
  .disease-card {
    background: var(--surface2);
    border-radius: 10px;
    padding: 12px;
    margin-bottom: 8px;
    border: 1px solid var(--border);
    cursor: pointer;
    transition: border-color 0.2s;
  }
  .disease-card:hover { border-color: rgba(56,189,248,0.3); }
  .disease-card:last-child { margin-bottom: 0; }

  .disease-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
  }

  .disease-name {
    font-size: 13px;
    font-weight: 500;
  }

  .disease-count {
    font-family: 'DM Mono', monospace;
    font-size: 18px;
    font-weight: 500;
    color: var(--accent);
  }

  .disease-count span {
    font-size: 11px;
    color: var(--text-dim);
  }

  .disease-bar {
    height: 3px;
    background: var(--border);
    border-radius: 99px;
    overflow: hidden;
    margin-top: 8px;
  }
  .disease-bar-fill {
    height: 100%;
    border-radius: 99px;
    transition: width 0.6s ease;
  }

  .trend {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    margin-top: 4px;
  }
  .trend.up { color: #ef4444; }
  .trend.down { color: #22c55e; }
  .trend.flat { color: var(--text-dim); }

  /* ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
  .news-item {
    background: var(--surface2);
    border-radius: 10px;
    padding: 12px;
    margin-bottom: 8px;
    border-left: 3px solid var(--risk-high);
  }

  .news-date {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    color: var(--text-dim);
    margin-bottom: 4px;
  }

  .news-text {
    font-size: 12px;
    line-height: 1.7;
    color: var(--text);
  }

  .news-source {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    color: var(--accent);
    margin-top: 6px;
  }

  /* å‡¡ä¾‹ */
  .legend {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
  }

  .legend-dot {
    width: 12px;
    height: 12px;
    border-radius: 3px;
    flex-shrink: 0;
  }

  /* åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«ä¸Šæ›¸ã */
  .leaflet-container { background: #0d1220 !important; }

  .leaflet-tile-pane { filter: brightness(0.35) saturate(0.3) hue-rotate(200deg); }

  .custom-tooltip {
    background: var(--surface) !important;
    border: 1px solid var(--border) !important;
    color: var(--text) !important;
    font-family: 'Noto Sans JP', sans-serif !important;
    font-size: 12px !important;
    border-radius: 8px !important;
    padding: 6px 10px !important;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5) !important;
  }

  .highlight-marker {
    width: 16px;
    height: 16px;
    background: var(--accent);
    border-radius: 50%;
    border: 2px solid white;
    box-shadow: 0 0 10px rgba(56,189,248,0.8);
  }

  /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
  .panel::-webkit-scrollbar { width: 4px; }
  .panel::-webkit-scrollbar-track { background: transparent; }
  .panel::-webkit-scrollbar-thumb { background: var(--border); border-radius: 99px; }
</style>
</head>
<body>

<header>
  <div class="logo">Vacci<span>Map</span></div>
  <div class="header-badge">â— LIVE</div>
  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="éƒµä¾¿ç•ªå·ã¾ãŸã¯ä½æ‰€ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼š176-0001ï¼‰" />
    <button class="search-btn" onclick="searchLocation()">æ¤œç´¢</button>
  </div>
</header>

<div id="map"></div>

<div class="panel">

  <!-- ã‚¨ãƒªã‚¢æƒ…å ± -->
  <div class="panel-section">
    <div class="panel-label">é¸æŠã‚¨ãƒªã‚¢</div>
    <div class="area-name" id="areaName">æ±äº¬éƒ½ ç·´é¦¬åŒº</div>
    <div style="margin-top:6px">
      <span class="risk-pill high" id="riskPill">
        <span>â—</span> é«˜ãƒªã‚¹ã‚¯
      </span>
    </div>
    <div style="margin-top:8px; font-size:12px; color:var(--text-dim); line-height:1.6" id="areaDesc">
      ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶è­¦å ±ç™ºä»¤ä¸­ã€‚ç¬¬6é€±å®šç‚¹å ±å‘Šæ•°42.50äººï¼ˆè­¦å ±åŸºæº–30.0äººè¶…ï¼‰ã€‚
    </div>
  </div>

  <!-- ç–¾æ‚£ãƒ‡ãƒ¼ã‚¿ -->
  <div class="panel-section">
    <div class="panel-label">æ„ŸæŸ“ç—‡ç™ºç”ŸçŠ¶æ³ï¼ˆ2026å¹´ç¬¬6é€±ï¼‰</div>
    <div id="diseaseList">
      <!-- JSã§ç”Ÿæˆ -->
    </div>
  </div>

  <!-- é€Ÿå ±ãƒ†ã‚­ã‚¹ãƒˆ -->
  <div class="panel-section">
    <div class="panel-label">ğŸ“¢ æœ€æ–°æƒ…å ±</div>

    <div class="news-item">
      <div class="news-date">2026-02-05 ï½œ æ±äº¬éƒ½æ„ŸæŸ“ç—‡æƒ…å ±ã‚»ãƒ³ã‚¿ãƒ¼</div>
      <div class="news-text">
        ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶ï¼šç¬¬6é€±ï¼ˆ2æœˆ2æ—¥ã€œ8æ—¥ï¼‰ã®å®šç‚¹å½“ãŸã‚Šæ‚£è€…å ±å‘Šæ•°ãŒ<strong>42.50äºº</strong>ã§ã€å†åº¦è­¦å ±åŸºæº–ï¼ˆ30.0äººï¼‰ã‚’è¶…ãˆã¾ã—ãŸã€‚1999å¹´ä»¥æ¥åˆã‚ã¦1ã‚·ãƒ¼ã‚ºãƒ³ã§2åº¦ç›®ã®è­¦å ±ã€‚Bå‹ãŒç´„90%ã‚’å ã‚ã¦ã„ã¾ã™ã€‚
      </div>
      <div class="news-source">â†— idsc.metro.tokyo.lg.jp</div>
    </div>

    <div class="news-item" style="border-left-color: var(--risk-moderate)">
      <div class="news-date">2026-02-14 ï½œ æ±äº¬éƒ½</div>
      <div class="news-text">
        RSVæ„ŸæŸ“ç—‡ï¼šå®šç‚¹å½“ãŸã‚Š<strong>5,785ä»¶</strong>ï¼ˆéƒ½å…¨ä½“ï¼‰ã€‚é«˜ã„æ°´æº–ã§æ¨ç§»ä¸­ã€‚ä¹³å¹¼å…ãƒ»é«˜é½¢è€…ã¯ç‰¹ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚
      </div>
      <div class="news-source">â†— ny.gov / CDC</div>
    </div>

    <div class="news-item" style="border-left-color: var(--risk-low)">
      <div class="news-date">2026-02-12 ï½œ åšç”ŸåŠ´åƒçœ</div>
      <div class="news-text">
        COVID-19ï¼šå®šç‚¹å½“ãŸã‚Š<strong>0.71äºº</strong>ï¼ˆå‰é€±0.43äººã‚ˆã‚Šå¾®å¢—ï¼‰ã€‚5é¡ç§»è¡Œå¾Œã¯ä½æ°´æº–ã§æ¨ç§»ã€‚
      </div>
      <div class="news-source">â†— mhlw.go.jp</div>
    </div>

  </div>

  <!-- å‡¡ä¾‹ -->
  <div class="panel-section">
    <div class="panel-label">ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«</div>
    <div class="legend">
      <div class="legend-item">
        <div class="legend-dot" style="background:#dc2626"></div>
        <span>ç·Šæ€¥ â€” è­¦å ±ãƒ¬ãƒ™ãƒ«è¶…éãƒ»æ„ŸæŸ“æ€¥å¢—</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background:#ef4444"></div>
        <span>é«˜ â€” æ³¨æ„å ±ãƒ»å®šç‚¹è¶…é</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background:#f59e0b"></div>
        <span>ä¸­ â€” æµè¡ŒæœŸå…¥ã‚Š</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background:#22c55e"></div>
        <span>ä½ â€” é€šå¸¸æ°´æº–</span>
      </div>
    </div>
  </div>

</div>

<script>
// â”€â”€ æ„ŸæŸ“ç—‡ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ‡ãƒ¢ç”¨ / ç›´è¿‘ãƒ‡ãƒ¼ã‚¿åæ˜ ï¼‰â”€â”€
const DISEASE_DATA = {
  "ç·´é¦¬åŒº": {
    risk: "high",
    riskLabel: "é«˜ãƒªã‚¹ã‚¯",
    desc: "ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶è­¦å ±ç™ºä»¤ä¸­ã€‚ç¬¬6é€±å®šç‚¹å ±å‘Šæ•°42.50äººï¼ˆè­¦å ±åŸºæº–30.0äººè¶…ï¼‰ã€‚",
    diseases: [
      { name: "ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶", count: 42.50, unit: "å®šç‚¹/é€±", change: +2.5, max: 60, color: "#ef4444" },
      { name: "RSV", count: 5785, unit: "ä»¶ï¼ˆéƒ½å…¨ä½“ï¼‰", change: 0, max: 8000, color: "#f59e0b" },
      { name: "COVID-19", count: 0.71, unit: "å®šç‚¹/é€±", change: +0.28, max: 5, color: "#f59e0b" },
      { name: "ãƒã‚¤ã‚³ãƒ—ãƒ©ã‚ºãƒè‚ºç‚", count: 12.3, unit: "å®šç‚¹/é€±", change: -1.2, max: 30, color: "#22c55e" },
    ]
  }
};

// 23åŒºã®ãƒªã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ‡ãƒ¢ï¼‰
const WARD_RISK = {
  "åƒä»£ç”°åŒº": "moderate", "ä¸­å¤®åŒº": "moderate", "æ¸¯åŒº": "low",
  "æ–°å®¿åŒº": "high",     "æ–‡äº¬åŒº": "moderate", "å°æ±åŒº": "moderate",
  "å¢¨ç”°åŒº": "low",      "æ±Ÿæ±åŒº": "low",      "å“å·åŒº": "moderate",
  "ç›®é»’åŒº": "low",      "å¤§ç”°åŒº": "moderate", "ä¸–ç”°è°·åŒº": "high",
  "æ¸‹è°·åŒº": "moderate", "ä¸­é‡åŒº": "high",     "æ‰ä¸¦åŒº": "high",
  "è±Šå³¶åŒº": "high",     "åŒ—åŒº": "moderate",   "è’å·åŒº": "low",
  "æ¿æ©‹åŒº": "high",     "ç·´é¦¬åŒº": "critical", "è¶³ç«‹åŒº": "moderate",
  "è‘›é£¾åŒº": "low",      "æ±Ÿæˆ¸å·åŒº": "low",
};

const RISK_COLOR = {
  low:      { fill: "#22c55e", opacity: 0.25 },
  moderate: { fill: "#f59e0b", opacity: 0.35 },
  high:     { fill: "#ef4444", opacity: 0.5  },
  critical: { fill: "#dc2626", opacity: 0.7  },
};

const RISK_LABEL = {
  low: "ä½ãƒªã‚¹ã‚¯", moderate: "ä¸­ãƒªã‚¹ã‚¯", high: "é«˜ãƒªã‚¹ã‚¯", critical: "ç·Šæ€¥"
};

// â”€â”€ åœ°å›³åˆæœŸåŒ– â”€â”€
const map = L.map('map', {
  center: [35.69, 139.72],
  zoom: 11,
  zoomControl: false,
});

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: 'Â© OpenStreetMap contributors',
  maxZoom: 18,
}).addTo(map);

L.control.zoom({ position: 'bottomleft' }).addTo(map);

// â”€â”€ GeoJSONèª­ã¿è¾¼ã¿ï¼ˆsmartnews-smri/japan-topographyï¼‰â”€â”€
const GEOJSON_URL =
  "https://raw.githubusercontent.com/smartnews-smri/japan-topography/main/data/municipality/geojson/s0010/N03-21_13_210101.json";

let geojsonLayer = null;
let highlightLayer = null;

function getRiskForWard(name) {
  for (const [ward, risk] of Object.entries(WARD_RISK)) {
    if (name.includes(ward)) return risk;
  }
  return "low";
}

function styleFeature(feature) {
  const name = feature.properties.N03_004 || feature.properties.N03_003 || "";
  const risk = getRiskForWard(name);
  const c = RISK_COLOR[risk];
  return {
    fillColor: c.fill,
    fillOpacity: c.opacity,
    color: "rgba(255,255,255,0.15)",
    weight: 1,
  };
}

fetch(GEOJSON_URL)
  .then(r => r.json())
  .then(data => {
    geojsonLayer = L.geoJSON(data, {
      style: styleFeature,
      onEachFeature: (feature, layer) => {
        const name = feature.properties.N03_004 || feature.properties.N03_003 || "ä¸æ˜";
        const risk = getRiskForWard(name);
        layer.bindTooltip(
          `<strong>${name}</strong><br>${RISK_LABEL[risk]}`,
          { className: 'custom-tooltip', sticky: true }
        );
        layer.on('click', () => selectWard(name, layer, feature));
      }
    }).addTo(map);
  })
  .catch(err => {
    console.warn("GeoJSONèª­ã¿è¾¼ã¿å¤±æ•—ï¼ˆCORSã®å¯èƒ½æ€§ï¼‰:", err);
    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ç·´é¦¬åŒºã®ä¸­å¿ƒã«ãƒãƒ¼ã‚«ãƒ¼ã ã‘è¡¨ç¤º
    showFallbackMarkers();
  });

function showFallbackMarkers() {
  const wards = [
    { name: "ç·´é¦¬åŒº", lat: 35.7358, lng: 139.6516, risk: "critical" },
    { name: "ä¸–ç”°è°·åŒº", lat: 35.6464, lng: 139.6530, risk: "high" },
    { name: "æ–°å®¿åŒº", lat: 35.6938, lng: 139.7034, risk: "high" },
    { name: "æ‰ä¸¦åŒº", lat: 35.6995, lng: 139.6363, risk: "high" },
    { name: "æ¿æ©‹åŒº", lat: 35.7508, lng: 139.7093, risk: "high" },
    { name: "ä¸­é‡åŒº", lat: 35.7075, lng: 139.6636, risk: "high" },
    { name: "è±Šå³¶åŒº", lat: 35.7281, lng: 139.7187, risk: "high" },
    { name: "æ¸¯åŒº",   lat: 35.6581, lng: 139.7514, risk: "low" },
    { name: "æ±Ÿæ±åŒº", lat: 35.6722, lng: 139.8172, risk: "low" },
  ];

  wards.forEach(w => {
    const c = RISK_COLOR[w.risk];
    L.circleMarker([w.lat, w.lng], {
      radius: 22,
      fillColor: c.fill,
      fillOpacity: c.opacity + 0.1,
      color: c.fill,
      weight: 2,
    })
    .bindTooltip(`<strong>${w.name}</strong><br>${RISK_LABEL[w.risk]}`,
      { className: 'custom-tooltip' })
    .addTo(map);
  });
}

// â”€â”€ åŒºé¸æŠ â”€â”€
function selectWard(name, layer, feature) {
  if (highlightLayer) map.removeLayer(highlightLayer);

  highlightLayer = L.geoJSON(feature, {
    style: {
      fillColor: "transparent",
      color: "#38bdf8",
      weight: 2.5,
      fillOpacity: 0,
    }
  }).addTo(map);

  const risk = getRiskForWard(name);
  updatePanel(name, risk);
}

function updatePanel(wardName, risk) {
  document.getElementById('areaName').textContent = `æ±äº¬éƒ½ ${wardName}`;

  const pill = document.getElementById('riskPill');
  pill.className = `risk-pill ${risk}`;
  pill.innerHTML = `<span>â—</span> ${RISK_LABEL[risk]}`;

  document.getElementById('areaDesc').textContent =
    risk === 'critical' ? "ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶è­¦å ±ç™ºä»¤ä¸­ã€‚å®šç‚¹å ±å‘Šæ•°ãŒè­¦å ±åŸºæº–ã‚’è¶…éã—ã¦ã„ã¾ã™ã€‚" :
    risk === 'high'     ? "è¤‡æ•°ã®æ„ŸæŸ“ç—‡ãŒæµè¡ŒæœŸã«å…¥ã£ã¦ã„ã¾ã™ã€‚æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚" :
    risk === 'moderate' ? "ä¸€éƒ¨ã®æ„ŸæŸ“ç—‡ãŒå¢—åŠ å‚¾å‘ã«ã‚ã‚Šã¾ã™ã€‚" :
                          "ç¾åœ¨ã€æ„ŸæŸ“ç—‡ã®æµè¡Œã¯é€šå¸¸æ°´æº–ã§ã™ã€‚";

  renderDiseases(wardName);
}

function renderDiseases(wardName) {
  const data = DISEASE_DATA["ç·´é¦¬åŒº"]; // ãƒ‡ãƒ¢: å…¨åŒºåŒã˜ãƒ‡ãƒ¼ã‚¿
  const list = document.getElementById('diseaseList');
  list.innerHTML = "";

  data.diseases.forEach(d => {
    const pct = Math.min(100, (d.count / d.max) * 100);
    const trendClass = d.change > 0 ? 'up' : d.change < 0 ? 'down' : 'flat';
    const trendIcon = d.change > 0 ? `â†‘ +${d.change}` : d.change < 0 ? `â†“ ${d.change}` : 'â†’ æ¨ªã°ã„';

    list.innerHTML += `
      <div class="disease-card">
        <div class="disease-header">
          <span class="disease-name">${d.name}</span>
          <span class="disease-count">${d.count}<span> ${d.unit}</span></span>
        </div>
        <div class="trend ${trendClass}">${trendIcon}</div>
        <div class="disease-bar">
          <div class="disease-bar-fill" style="width:${pct}%; background:${d.color}"></div>
        </div>
      </div>`;
  });
}

// â”€â”€ ä½æ‰€ãƒ»éƒµä¾¿ç•ªå·æ¤œç´¢ â”€â”€
async function searchLocation() {
  const query = document.getElementById('searchInput').value.trim();
  if (!query) return;

  try {
    const res = await fetch(
      `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query + " æ±äº¬")}&format=json&limit=1&accept-language=ja`
    );
    const results = await res.json();

    if (results.length === 0) {
      alert("å ´æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ");
      return;
    }

    const { lat, lon, display_name } = results[0];
    map.flyTo([lat, lon], 13, { duration: 1.2 });

    // ãƒãƒ¼ã‚«ãƒ¼è¿½åŠ 
    const icon = L.divIcon({
      html: '<div class="highlight-marker"></div>',
      iconSize: [16, 16],
      className: '',
    });
    L.marker([lat, lon], { icon })
      .addTo(map)
      .bindPopup(`<strong>${display_name}</strong>`)
      .openPopup();

    // åŒºåã‚’æŠ½å‡ºã—ã¦ãƒ‘ãƒãƒ«æ›´æ–°
    const wardMatch = display_name.match(/([^\s,]+åŒº)/);
    if (wardMatch) {
      const ward = wardMatch[1];
      const risk = getRiskForWard(ward);
      updatePanel(ward, risk);
    }

  } catch(e) {
    alert("æ¤œç´¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
  }
}

// Enterã‚­ãƒ¼ã§æ¤œç´¢
document.getElementById('searchInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') searchLocation();
});

// åˆæœŸè¡¨ç¤º
renderDiseases("ç·´é¦¬åŒº");
</script>
</body>
</html>
